name: Build

on: [push, pull_request]

# ===== プロジェクトに合わせて変更 =====
env:
  IDF_TARGET: esp32s3       # チップ (esp32, esp32s3, esp32c3, esp32c6 等)
  IDF_VERSION: v5.4         # Justfile の IDF_VERSION と揃える
# ========================================

jobs:
  build:
    runs-on: ubuntu-latest
    container: espressif/idf:${{ env.IDF_VERSION }}
    steps:
      - uses: actions/checkout@v4
      - run: idf.py set-target $IDF_TARGET
      - run: idf.py build

  fmt-check:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - name: Check format
        run: |
          sudo apt-get update -qq && sudo apt-get install -y -qq clang-format > /dev/null 2>&1
          find main components -name '*.c' -o -name '*.h' | xargs clang-format --dry-run --Werror
